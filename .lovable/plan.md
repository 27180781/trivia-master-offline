
## אבחון (למה זה לא עובד כרגע)
מהצילום ששלחת רואים אזהרות:
- `שורה 2: נדרשות לפחות 2 תשובות`
- `שורה 3: נדרשות לפחות 2 תשובות`

זה קורה כי בקובץ האקסל שלך הכותרת של העמודה היא **`מס' תשובה נכונה`**, אבל בקוד אנחנו מחפשים רק את הכותרת **`מספר התשובה הנכונה`** (`EXCEL_COLUMN_MAP.correctAnswer`).

בגלל חוסר התאמה בכותרת:
- `correctAnswerRaw` יוצא ריק (`''`)
- השקופית לא מזוהה כ-`טקסט`
- ואז הוולידציה דורשת “לפחות 2 תשובות” ונופלת על שתי השורות הראשונות (שהן באמת טקסט בלי תשובות)

כלומר: הבעיה היא **מיפוי כותרות האקסל**, לא “טקסט” עצמו.

---

## מה נשנה כדי שזה יעבוד תמיד
### 1) להפוך את קריאת עמודות באקסל ל”עמידה” לשמות שונים
קובץ יעד: `src/lib/excelParser.ts`

נוסיף מנגנון שמזהה עמודות לפי “רשימת שמות אפשריים” (כולל וריאציות נפוצות) במקום להסתמך על שם אחד קשיח.

דוגמא למיפוי שנתמוך בו (לעמודת תשובה נכונה):
- `מספר התשובה הנכונה` (הקיים)
- `מס' תשובה נכונה` (הקובץ שלך)
- `מס׳ תשובה נכונה` (גרש עברי)
- `מספר תשובה נכונה`
- (אופציונלי) `Correct Answer`, `correctAnswer`

טכנית:
- ניצור helper כמו `getCellValue(row, candidateHeaders)` שמחזיר את הערך לפי הכותרת הראשונה שקיימת בשורה.
- נשתמש בו עבור `correctAnswer`, ובמידת הצורך גם עבור `question/timeLimit/points` (כדי למנוע תקלות עתידיות).

---

### 2) להוסיף בדיקת “עמודות חובה” עם הודעת שגיאה ברורה
קובץ יעד: `src/lib/excelParser.ts`

אם לא נמצאה עמודת “תשובה נכונה” באף אחד מהשמות הנתמכים:
- נחזיר `success: false`
- עם הודעה ברורה בסגנון:
  - “לא נמצאה עמודת ‘מספר התשובה הנכונה’ / ‘מס' תשובה נכונה’. בדקי את כותרות העמודות באקסל.”

זה ימנע מצב שהקובץ “נטען בהצלחה” אבל בפועל שקופיות נעלמות.

---

### 3) להקשיח זיהוי סוג שקופית “טקסט”
קובץ יעד: `src/lib/excelParser.ts`

גם אחרי שמיפוי הכותרת יעבוד, נחזק את הזיהוי כך שיתמודד עם:
- רווחים (`"טקסט "`)
- וריאציות באנגלית (אם תרצי): `"Text"`, `"TEXT"`

טכנית:
- ננרמל את הערך (`trim`, המרה למחרוזת)
- נשווה מול סט ערכים ידועים.

---

### 4) להציג ירידות שורה מתוך אקסל בצורה יפה (מומלץ במיוחד לשקופיות טקסט)
בעיה נפוצה: באקסל יש ירידות שורה, אבל בדפדפן הן לא תמיד מוצגות.

קבצים:
- `src/lib/excelParser.ts` (נרמול טקסט)
- `src/components/game/QuestionDisplay.tsx` (CSS להצגת ירידות שורה)

מה נעשה:
- בפרסר נחליף `<br/>` אם מופיע בטקסט, ונאחד `\r\n` ל-`\n`
- ב-`QuestionDisplay` נוסיף למחלקות של הטקסט `whitespace-pre-wrap` (או `whitespace-pre-line`) כדי שירידות השורה יוצגו.

---

### 5) (אופציונלי) לשפר את ה־Setup Summary וה־Preview כך ש”טקסט” ייספר בנפרד
קובץ יעד: `src/pages/Setup.tsx`

כרגע המספרים ב־Setup מחשבים “טריוויה” כ־`!isSurvey` ולכן שקופיות טקסט עלולות להיכנס לשם.
נשפר:
- להוסיף ספירה נפרדת: “טקסט”
- להוציא טקסט מחישוב “טריוויה”
- בתצוגה מקדימה: להציג תגית “טקסט” ולהימנע מלהציג “0 תשובות • X שניות” עבור טקסט (כי זה מבלבל)

---

## איך נבדוק שזה נפתר (בדיקות קבלה)
1) להעלות את הקובץ שלך `חסר_לי_שם_2_שאלות_1-3.xlsx` ב־Setup
   - לא אמורות להיות אזהרות “נדרשות לפחות 2 תשובות” עבור שורות הטקסט
   - אמורות להופיע כל השאלות כולל 2 שקופיות הטקסט הראשונות
2) להתחיל משחק ולוודא:
   - שקופית 1 (טקסט) מוצגת
   - בלחיצה עוברים לשקופית 2 (טקסט)
   - בלחיצה עוברים לשאלה 3 (שאלה רגילה)
3) להעלות גם קובץ אקסל ישן (אם יש לך) שבו הכותרת היא `מספר התשובה הנכונה` כדי לוודא שלא שברנו תאימות לאחור.

---

## קבצים שיושפעו
- `src/lib/excelParser.ts` (עיקר התיקון)
- `src/components/game/QuestionDisplay.tsx` (הצגת ירידות שורה)
- `src/pages/Setup.tsx` (אופציונלי: ספירות/תצוגה מקדימה)

---

## הערות טכניות (לשקיפות)
- כרגע הקובץ שלך מכיל כותרת `מס' תשובה נכונה` (רואים את זה גם מה-parsing של המסמך).
- בגלל שהקוד משתמש ב-`EXCEL_COLUMN_MAP.correctAnswer` בלבד, הוא לא “רואה” את ערך `טקסט` ולכן מפעיל וולידציה של תשובות.
- הפתרון הנכון הוא תמיכה בוריאציות של כותרות + הודעת שגיאה ברורה אם עמודה חסרה, כדי שלא “נטען בהצלחה” כשחסרה עמודה קריטית.

<lov-actions>
<lov-suggestion message="אחרי שאיישם את התיקון, העלה שוב את אותו קובץ אקסל ובדוק ב-Setup שאין אזהרות וששתי שקופיות הטקסט הראשונות מופיעות גם במשחק.">בדיקה מקצה לקצה</lov-suggestion>
<lov-suggestion message="להוסיף ספירה נפרדת של 'טקסט' במסך Setup (במקום שייכנס ל'טריוויה') + תגית 'טקסט' בתצוגה מקדימה.">שיפור מסך Setup</lov-suggestion>
<lov-suggestion message="להוסיף תמיכה גם בכותרות באנגלית (Question, Answer 1-6, Correct Answer, Time Limit, Points) כדי לאפשר תבנית דו-לשונית.">תמיכה באנגלית באקסל</lov-suggestion>
<lov-suggestion message="להוסיף אפשרות לשקופית טקסט עם תמונה (עמודה נוספת באקסל, למשל 'תמונה', שמקבלת URL או שם קובץ) והצגה במשחק.">טקסט עם תמונה</lov-suggestion>
<lov-suggestion message="להוסיף כפתור/קיצור 'דלג' אוטומטי לשקופית הבאה אחרי X שניות עבור שקופיות טקסט (אופציונלי בהגדרות).">מעבר אוטומטי לטקסט</lov-suggestion>
</lov-actions>
